<style>
  .mcskin-container {
    width: 200px;
    height: 250px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle,
        rgba(255, 255, 255, 0.05) 0%,
        rgba(0, 0, 0, 0.1) 100%);
    border-radius: 12px;
    margin: 10px;
    transition: transform 0.3s ease;
    cursor: pointer;
    overflow: hidden;
  }

  .mcskin-container canvas {
    display: block;
  }
</style>

<div class="mcskin-container" data-username="Louixch"></div>
<div class="mcskin-container" data-username="Steve"></div>
<div class="mcskin-container" data-username="Michaelninder"></div>
<div class="mcskin-container" data-username="Duesslo"></div>
<div class="mcskin-container" data-username="Fuchsboy_jgb"></div>
<div class="mcskin-container" data-username="Fabimaster6h"></div>
<div class="mcskin-container" data-username="Fabimaster7h"></div>
<div class="mcskin-container" data-username="microsoft"></div>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
    }
  }
</script>

<script type="module">
  import * as THREE from "three";

  function createPart(w, h, d, uvX, uvY, material) {
    const geometry = new THREE.BoxGeometry(w, h, d);
    const canvasW = 64;
    const canvasH = 64;
    const uvs = geometry.attributes.uv.array;

    const faceUvs = [
      [uvX + d + w, uvY + d, d, h],
      [uvX, uvY + d, d, h],
      [uvX + d, uvY, w, d],
      [uvX + d + w, uvY, w, d],
      [uvX + d, uvY + d, w, h],
      [uvX + d + w + d, uvY + d, w, h],
    ];

    for (let i = 0; i < 6; i++) {
      const [x, y, pw, ph] = faceUvs[i];
      const u0 = x / canvasW;
      const v0 = 1 - (y + ph) / canvasH;
      const u1 = (x + pw) / canvasW;
      const v1 = 1 - y / canvasH;
      const offset = i * 8;
      uvs[offset] = u0;
      uvs[offset + 1] = v1;
      uvs[offset + 2] = u1;
      uvs[offset + 3] = v1;
      uvs[offset + 4] = u0;
      uvs[offset + 5] = v0;
      uvs[offset + 6] = u1;
      uvs[offset + 7] = v0;
    }

    return new THREE.Mesh(geometry, material);
  }

  function initSkin(el) {
    const username = el.dataset.username;
    const width = el.clientWidth || 200;
    const height = el.clientHeight || 250;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });

    renderer.setSize(width, height);
    renderer.setPixelRatio(window.devicePixelRatio);

    renderer.colorManagement = true;
    renderer.outputColorSpace = THREE.SRGBColorSpace;

    el.appendChild(renderer.domElement);

    const loader = new THREE.TextureLoader();
    loader.setCrossOrigin("anonymous");

    const texture = loader.load(`https://mineskin.eu/skin/${username}`);
    texture.magFilter = THREE.NearestFilter;
    texture.minFilter = THREE.NearestFilter;
    texture.colorSpace = THREE.SRGBColorSpace;

    const material = new THREE.MeshStandardMaterial({
      map: texture,
      transparent: true,
      side: THREE.FrontSide,
      roughness: 1,
      metalness: 0,
    });

    const head = createPart(8, 8, 8, 0, 0, material);
    head.position.y = 4;

    const body = createPart(8, 12, 4, 16, 16, material);
    body.position.y = -6;

    const leftArm = createPart(4, 12, 4, 32, 48, material);
    leftArm.position.set(-6, -6, 1.5);
    leftArm.rotation.x = -0.33;
    leftArm.rotation.y = -0.1;

    const rightArm = createPart(4, 12, 4, 40, 16, material);
    rightArm.position.set(6, -6, 1.5);
    rightArm.rotation.x = -0.35;
    rightArm.rotation.y = 0.1;

    const bust = new THREE.Group();
    bust.add(head, body, leftArm, rightArm);
    bust.rotation.y = 0;
    bust.position.y = 2;
    scene.add(bust);

    const light = new THREE.DirectionalLight(0xffffff, 1.2);
    light.position.set(5, 10, 10);
    scene.add(light);

    const ambient = new THREE.AmbientLight(0xffffff, 0.9);
    scene.add(ambient);

    camera.position.set(0, 0, 32);
    camera.lookAt(0, 0, 0);

    let isHovering = false;
    let targetRotY = 0;
    let targetHeadRotX = 0;

    el.addEventListener("mouseenter", () => {
      isHovering = true;
      targetRotY = Math.PI / 4;
      targetHeadRotX = .2;
    });

    el.addEventListener("mouseleave", () => {
      isHovering = false;
      targetRotY = 0;
      targetHeadRotX = 0;
    });

    function animate() {
      requestAnimationFrame(animate);

      bust.rotation.y += (targetRotY - bust.rotation.y) * 0.1;
      //head.position.y += ((5 * Math.random()) - head.position.y) * 0.1;
      //head.rotation.y += (targetHeadRotX - head.rotation.y) * 0.1; // FUNNY !!!
      head.rotation.x += (targetHeadRotX - head.rotation.x) * 0.1;

      renderer.render(scene, camera);
    }

    animate();
  }

  document.querySelectorAll(".mcskin-container").forEach(initSkin);
</script>